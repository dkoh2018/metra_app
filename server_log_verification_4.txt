
> metra-schedule-tracker@1.0.0 start
> NODE_ENV=production node dist/index.js

[dotenv@17.2.3] injecting env (2) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
Found 1966 trips (UP-NW + MD-W + UP-N + BNSF)
Found 35482 stop times for all supported lines
Inserted 3932 schedule records
GTFS data loaded successfully!
â° [SCHEDULE] Forcing immediate daily seed for verification...
â° [SCHEDULE] Starting daily crowding seed (3:30 AM)...
â° [SCHEDULE] No active routes found, adding defaults...
â° [SCHEDULE] Found 2 routes to seed: PALATINE->OTC, OTC->PALATINE
[SCHEDULED] Starting scraping for PALATINE->OTC (Line: UP-NW)...
â° [SCHEDULE] Next daily scrape scheduled for 12/19/2025, 3:30:00 AM (in 2 hours)
ðŸ“… GTFS: Data is just updated, no update needed
âœ… Database initialized successfully
â±ï¸  Starting real-time data polling...
ðŸŒ¦ï¸  Starting weather data polling (dynamic interval)...
ðŸŒ¦ï¸  Next weather update in 30 min (active=false)
âœ… Using Puppeteer's bundled Chrome at: /Users/davidoh/.cache/puppeteer/chrome/mac_arm-143.0.7499.42/chrome-mac-arm64/Google Chrome for Testing.app/Contents/MacOS/Google Chrome for Testing
[SCHEDULED] Using overridden schedule date: 12/19/2025, 4:00:00 AM (1766138400)
[SCHEDULED] Constructed URL: https://www.metra.com/schedules?line=UP-NW&orig=PALATINE&dest=OTC&time=1766138400&allstops=0&redirect=1766128313
Real-time data updated successfully
âœ… Weather data updated for 3 locations
âœ… Backend server running on http://localhost:3001/
ðŸ“¡ API endpoints available at http://localhost:3001/api/*
â±ï¸  Server polling aligned to wall clock (:00/:30)
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[SCHEDULED] Saved/Updated 0 entries for PALATINE->OTC
[WARNING] No crowding data extracted from Metra website for PALATINE->OTC
[DEBUG] Saved failure screenshot to: /Users/davidoh/.gemini/antigravity/brain/4d9a56e9-809b-4662-8f2d-7e10e7e89502/debug_scrape_fail_PALATINE_1766128324902.png
[SCHEDULED] Scraping failed: No crowding data extracted from Metra website
â° [SCHEDULE] Failed to seed PALATINE->OTC: No crowding data extracted from Metra website
[SCHEDULED] Starting scraping for OTC->PALATINE (Line: UP-NW)...
[SCHEDULED] Using overridden schedule date: 12/19/2025, 4:00:00 AM (1766138400)
[SCHEDULED] Constructed URL: https://www.metra.com/schedules?line=UP-NW&orig=OTC&dest=PALATINE&time=1766138400&allstops=0&redirect=1766128325
[API] [1766128334073-i3d5xmdjn] Crowding request: OTC->WILMETTE (force=undefined)
[API] [1766128334073-i3d5xmdjn] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE MISS] No fresh cache for OTC->WILMETTE (checking for stale cache or scraping...)
[CACHE MISS] No fresh cache (< 5 min) for OTC->WILMETTE, checking stale cache or scraping...
[CACHE] No stale cache available for OTC->WILMETTE
[API] Starting scraping for OTC->WILMETTE (Line: UP-N)...
[API] [1766128334073-i3d5xmdjn] Waiting for scraping promise to complete for OTC->WILMETTE...
[API] Constructed URL: https://www.metra.com/schedules?line=UP-N&orig=OTC&dest=WILMETTE&time=1766124734&allstops=0&redirect=1766128334
[SCHEDULED] Saved/Updated 0 entries for OTC->PALATINE
[WARNING] No crowding data extracted from Metra website for OTC->PALATINE
[DEBUG] Saved failure screenshot to: /Users/davidoh/.gemini/antigravity/brain/4d9a56e9-809b-4662-8f2d-7e10e7e89502/debug_scrape_fail_OTC_1766128336279.png
[SCHEDULED] Scraping failed: No crowding data extracted from Metra website
â° [SCHEDULE] Failed to seed OTC->PALATINE: No crowding data extracted from Metra website
â° [SCHEDULE] Daily seed completed!
[API] Saved/Updated 0 entries for OTC->WILMETTE
[WARNING] No crowding data extracted from Metra website for OTC->WILMETTE
[DEBUG] Saved failure screenshot to: /Users/davidoh/.gemini/antigravity/brain/4d9a56e9-809b-4662-8f2d-7e10e7e89502/debug_scrape_fail_OTC_1766128345410.png
[API] Scraping failed: No crowding data extracted from Metra website
[API ERROR] [1766128334073-i3d5xmdjn] Scraping failed after 11534ms for OTC->WILMETTE: No crowding data extracted from Metra website
[API ERROR] [1766128334073-i3d5xmdjn] Stack: Error: No crowding data extracted from Metra website
    at file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1128:15
    at async scrapeAndCacheCrowding (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1150:20)
    at async file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1699:26
Scraping failed for OTC->WILMETTE: No crowding data extracted from Metra website
[CROWDING] No data available for OTC->WILMETTE (scraping failed, no stale cache)
[API] [1766128334073-i3d5xmdjn] Sending response after 11534ms (0 entries)
[API] [1766128334073-i3d5xmdjn] Request completed in 11534ms
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] [1766128394076-m7euzxxe5] Crowding request: OTC->WILMETTE (force=undefined)
[API] [1766128394076-m7euzxxe5] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE MISS] No fresh cache for OTC->WILMETTE (checking for stale cache or scraping...)
[CACHE MISS] No fresh cache (< 5 min) for OTC->WILMETTE, checking stale cache or scraping...
[CACHE] No stale cache available for OTC->WILMETTE
[API] Starting scraping for OTC->WILMETTE (Line: UP-N)...
[API] [1766128394076-m7euzxxe5] Waiting for scraping promise to complete for OTC->WILMETTE...
[API] Constructed URL: https://www.metra.com/schedules?line=UP-N&orig=OTC&dest=WILMETTE&time=1766124794&allstops=0&redirect=1766128394
[API] Scraping failed: Navigating frame was detached
[API ERROR] [1766128394076-m7euzxxe5] Scraping failed after 1285ms for OTC->WILMETTE: Navigating frame was detached
[API ERROR] [1766128394076-m7euzxxe5] Stack: Error: Navigating frame was detached
    at <instance_members_initializer> (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/node_modules/.pnpm/puppeteer-core@24.33.0/node_modules/puppeteer-core/lib/esm/puppeteer/cdp/LifecycleWatcher.js:33:14)
    at new LifecycleWatcher (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/node_modules/.pnpm/puppeteer-core@24.33.0/node_modules/puppeteer-core/lib/esm/puppeteer/cdp/LifecycleWatcher.js:37:16)
    at CdpFrame.goto (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/node_modules/.pnpm/puppeteer-core@24.33.0/node_modules/puppeteer-core/lib/esm/puppeteer/cdp/Frame.js:145:29)
    at CdpFrame.<anonymous> (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/node_modules/.pnpm/puppeteer-core@24.33.0/node_modules/puppeteer-core/lib/esm/puppeteer/util/decorators.js:101:27)
    at CdpPage.goto (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/node_modules/.pnpm/puppeteer-core@24.33.0/node_modules/puppeteer-core/lib/esm/puppeteer/api/Page.js:568:43)
    at file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1034:18
    at async scrapeAndCacheCrowding (file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1150:20)
    at async file:///Users/davidoh/2025/depaul/CREDICO/metra-schedule-tracker/dist/index.js:1699:26
Scraping interrupted for OTC->WILMETTE (browser detached - likely server restart)
[CROWDING] No data available for OTC->WILMETTE (scraping failed, no stale cache)
[API] [1766128394076-m7euzxxe5] Sending response after 1285ms (0 entries)
[API] [1766128394076-m7euzxxe5] Request completed in 1285ms
