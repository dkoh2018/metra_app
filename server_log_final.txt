
> metra-schedule-tracker@1.0.0 start
> NODE_ENV=production node dist/index.js

[dotenv@17.2.3] injecting env (2) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
Found 1966 trips (UP-NW + MD-W + UP-N + BNSF)
Found 35482 stop times for all supported lines
Inserted 3932 schedule records
GTFS data loaded successfully!
â° [SCHEDULE] Next daily scrape scheduled for 12/19/2025, 3:30:00 AM (in 2 hours)
ðŸ“… GTFS: Data is just updated, no update needed
âœ… Database initialized successfully
â±ï¸  Starting real-time data polling...
ðŸŒ¦ï¸  Starting weather data polling (dynamic interval)...
ðŸŒ¦ï¸  Next weather update in 30 min (active=false)
Real-time data updated successfully
âœ… Weather data updated for 3 locations
âœ… Backend server running on http://localhost:3001/
ðŸ“¡ API endpoints available at http://localhost:3001/api/*
â±ï¸  Server polling aligned to wall clock (:00/:30)
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] [1766128532353-dh3sdv3wq] Crowding request: OTC->WILMETTE (force=undefined)
[API] [1766128532353-dh3sdv3wq] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for OTC->WILMETTE (1 trains, -358 min old)
[API] [1766128532353-dh3sdv3wq] Request completed in 1ms
[API] [1766128535113-as901qceo] Crowding request: OTC->PALATINE (force=undefined)
[API] [1766128535113-as901qceo] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for OTC->PALATINE (34 trains, -358 min old)
[API] [1766128535113-as901qceo] Request completed in 1ms
[API] [1766128539939-ld8xc2bvn] Crowding request: PALATINE->OTC (force=undefined)
[API] [1766128539939-ld8xc2bvn] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for PALATINE->OTC (35 trains, -358 min old)
[API] [1766128539939-ld8xc2bvn] Request completed in 1ms
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] [1766128599953-x4dhkdjhx] Crowding request: PALATINE->OTC (force=undefined)
[API] [1766128599953-x4dhkdjhx] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for PALATINE->OTC (35 trains, -357 min old)
[API] [1766128599953-x4dhkdjhx] Request completed in 1ms
[API] [1766128612929-q5v7pipj7] Crowding request: OTC->PALATINE (force=undefined)
[API] [1766128612929-q5v7pipj7] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for OTC->PALATINE (34 trains, -357 min old)
[API] [1766128612929-q5v7pipj7] Request completed in 2ms
Real-time data updated successfully
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] [1766128621186-efkxbvezs] Crowding request: WILMETTE->OTC (force=undefined)
[API] [1766128621186-efkxbvezs] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE MISS] No fresh cache for WILMETTE->OTC (checking for stale cache or scraping...)
[CACHE MISS] No fresh cache (< 5 min) for WILMETTE->OTC, checking stale cache or scraping...
[CACHE] No stale cache available for WILMETTE->OTC
[API] Starting scraping for WILMETTE->OTC (Line: UP-N)...
[API] [1766128621186-efkxbvezs] Waiting for scraping promise to complete for WILMETTE->OTC...
âœ… Using Puppeteer's bundled Chrome at: /Users/davidoh/.cache/puppeteer/chrome/mac_arm-143.0.7499.42/chrome-mac-arm64/Google Chrome for Testing.app/Contents/MacOS/Google Chrome for Testing
[API] Constructed URL: https://www.metra.com/schedules?line=UP-N&orig=WILMETTE&dest=OTC&time=1766125021&allstops=0&redirect=1766128621
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] Saved/Updated 35 entries for WILMETTE->OTC
[API] [1766128621186-efkxbvezs] Scraping completed for WILMETTE->OTC, result has 35 entries
[API] [1766128621186-efkxbvezs] Sending JSON response for WILMETTE->OTC...
[API] [1766128621186-efkxbvezs] Sending response after 7721ms (35 entries)
[API] [1766128621186-efkxbvezs] Request completed in 7722ms
[API] [1766128641583-f8hla2gx9] Crowding request: OTC->PALATINE (force=undefined)
[API] [1766128641583-f8hla2gx9] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE HIT] Returning cached crowding data for OTC->PALATINE (34 trains, -356 min old)
[API] [1766128641583-f8hla2gx9] Request completed in 1ms
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[POSITIONS] Bulk cached 4 trains across all lines
[API] [1766128644227-kq3qbjucm] Crowding request: CUS->SCHAUM (force=undefined)
[API] [1766128644227-kq3qbjucm] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE MISS] No fresh cache for CUS->SCHAUM (checking for stale cache or scraping...)
[CACHE MISS] No fresh cache (< 5 min) for CUS->SCHAUM, checking stale cache or scraping...
[CACHE] No stale cache available for CUS->SCHAUM
[API] Starting scraping for CUS->SCHAUM (Line: MD-W)...
[API] [1766128644227-kq3qbjucm] Waiting for scraping promise to complete for CUS->SCHAUM...
[API] Constructed URL: https://www.metra.com/schedules?line=MD-W&orig=CUS&dest=SCHAUM&time=1766125044&allstops=0&redirect=1766128644
[API] [1766128645430-5astvb555] Crowding request: CUS->SCHAUM (force=undefined)
[API] [1766128645430-5astvb555] Railway env check - NODE_ENV: production, PORT: undefined
[DB] Schema check passed: 'predicted_departure' column exists.
[CACHE MISS] No fresh cache for CUS->SCHAUM (checking for stale cache or scraping...)
Scraping already in progress for CUS->SCHAUM, waiting...
Real-time data updated successfully
[API] Saved/Updated 21 entries for CUS->SCHAUM
[API] [1766128644227-kq3qbjucm] Scraping completed for CUS->SCHAUM, result has 21 entries
[API] [1766128644227-kq3qbjucm] Sending JSON response for CUS->SCHAUM...
[API] [1766128644227-kq3qbjucm] Sending response after 7509ms (21 entries)
[API] [1766128644227-kq3qbjucm] Request completed in 7509ms
[API] [1766128645430-5astvb555] Request completed in 6306ms
